<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./../assets/css/style.css">
    <title>Graphique SNCF</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <header>
        <nav>
            <div class="navbar">
                <a href="#"><img src="./../assets/images/LOGO.png" alt="logo gare a vous !"></a>
                <div class="burger-icon" onclick="toggleMenu()">
                    <div class="barre"></div>
                    <div class="barre"></div>
                    <div class="barre"></div>
                </div>
            </div>
        </nav>
        <div id="menu_burger" class="active" style="left: -300px;">
            <a href="./../index.html">Accueil</a>
            <a href="./restauration.html">La carte de restauration bar TGV</a>
            <a href="#">La propreté des gares</a>
            <a href="./securite.html">La sécurité des trains</a>
        </div>
    </header>
    <main>
        <section class="proprete">
            <h1>La propreté des gares</h1>
            <div class="card-image">
                <img src="./../assets/images/Obsessive compulsive disorder-rafiki.png" alt="personne qui nettoie"
                    class="card-img">
            </div>
            <canvas id="myChart" width="400" height="200"></canvas>
        </section>


    </main>
    <footer>
        <div>
            <p>
                Raphaël | Eliot 2023 ©
            </p>
        </div>
    </footer>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Récupérer les données de l'API SNCF avec fetch
            fetch("https://ressources.data.sncf.com//api/explore/v2.1/catalog/datasets/proprete-en-gare/records?select=nom_gare,YEAR(mois) as annee,AVG(taux_de_conformite) as Taux&where=nom_gare%20IN%20('Angoul%C3%AAme'%2C%20'Bordeaux%20Saint-Jean'%2C%20'Poitiers')&group_by=nom_gare,YEAR(mois)&limit=20")
                .then(response => response.json())
                .then(data => {
                    const years = Array.from(new Set(data.results.map(record => record.YEAR_mois)));
                    const datasets = [];

                    data.results.forEach(record => {
                        const gareIndex = datasets.findIndex(dataset => dataset.label === record.nom_gare);

                        if (gareIndex === -1) {
                            datasets.push({
                                label: record.nom_gare,
                                data: [],
                                backgroundColor: getRandomColor(),
                                borderColor: getRandomColor(),
                                borderWidth: 1
                            });
                        }

                        const index = datasets.findIndex(dataset => dataset.label === record.nom_gare);
                        datasets[index].data.push(record.Taux);
                    });
                    console.log(years);

                    // Créer le graphique avec Chart.js
                    const ctx = document.getElementById('myChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['2019', '2020', '2021', '2022', '2023'],
                            datasets: datasets
                        },
                        options: {
                            scales: {
                                x: {
                                    stacked: false
                                },
                                y: {
                                    stacked: false
                                }
                            }
                        }
                    });
                })
                .catch(error => console.error('Erreur lors de la récupération des données :', error));
        });




        // Fonction pour générer une couleur aléatoire
        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }
    </script>
    <script src="./../assets/js/script.js"></script>
</body>

</html>